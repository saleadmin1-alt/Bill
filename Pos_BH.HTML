<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Hóa đơn bán hàng</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; font-size: 14px; }
    h2 { text-align: center; margin: 5px 0; }
    .store-info { text-align: center; margin-bottom: 10px; }
    .store-info p { margin: 2px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid black; }
    th, td { padding: 5px; text-align: center; }
    .total { font-weight: bold; }
    .footer { text-align: center; margin-top: 15px; font-style: italic; }
  </style>
</head>
<body>
  <div class="store-info">
    <h2 id="storeName">Cửa hàng chưa đặt tên</h2>
    <p id="storeAddress">Địa chỉ:</p>
    <p id="storePhone">SĐT:</p>
  </div>

  <h2>HÓA ĐƠN BÁN HÀNG</h2>
  <p><strong>Mã HĐ:</strong> <span id="billId"></span></p>
  <p><strong>Khách hàng:</strong> <span id="customerName"></span></p>
  <p><strong>Địa chỉ KH:</strong> <span id="customerAddress"></span></p>

  <table id="productTable">
    <thead>
      <tr>
        <th>STT</th>
        <th>Tên hàng</th>
        <th>SL</th>
        <th>Đơn giá</th>
        <th>Thành tiền</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr class="total">
        <td colspan="4">TỔNG CỘNG</td>
        <td id="totalAmount">0 VND</td>
      </tr>
    </tfoot>
  </table>

  <div class="footer">
    Xin cảm ơn quý khách và hẹn gặp lại!
  </div>

  <script>
    // Hàm lấy tham số từ URL
    function getParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name) || "";
    }

    // Hiển thị thông tin cửa hàng
    document.getElementById("storeName").textContent = getParam("tencuahang") || "Cửa hàng chưa đặt tên";
    document.getElementById("storeAddress").textContent = "Địa chỉ: " + (getParam("diachicuahang") || "");
    document.getElementById("storePhone").textContent = "SĐT: " + (getParam("dienthoaicuahang") || "");

    // Hiển thị thông tin hóa đơn
    document.getElementById("billId").textContent = getParam("id");
    document.getElementById("customerName").textContent = getParam("ten");
    document.getElementById("customerAddress").textContent = getParam("diachi");

    // Hiển thị danh sách sản phẩm
    const data = getParam("data");
    const rows = data.split("_n_");
    let tbody = document.querySelector("#productTable tbody");
    let total = 0;

    rows.forEach((row, index) => {
      if (row.trim() === "") return;
      const parts = row.split("|");
      const stt = index + 1;
      const tenhang = parts[1] || "";
      const sl = parts[3] || "0";
      const dongia = parts[4] || "0";
      const thanhtien = parts[5] || "0";
      total += parseFloat(thanhtien);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${stt}</td>
        <td>${tenhang}</td>
        <td>${sl}</td>
        <td>${dongia}</td>
        <td>${thanhtien}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById("totalAmount").textContent = total.toLocaleString("vi-VN") + " VND";
  </script>
</body>
</html>
