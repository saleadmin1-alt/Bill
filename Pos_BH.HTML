<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>H√≥a ƒë∆°n b√°n h√†ng</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, h3 { text-align: center; margin: 3px 0; }
    .center { text-align: center; }
    .barcode-box { text-align: center; margin: 10px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid black; }
    th, td { padding: 5px; text-align: center; }
    .total-row td { font-weight: bold; }
    .footer { text-align: center; margin-top: 15px; font-style: italic; }
    button { margin: 15px auto; display: block; padding: 8px 15px; font-size: 14px; }
  </style>
</head>
<body>
  <h2 id="tencuahang">C·ª≠a h√†ng</h2>
  <div class="center">
    <div id="diachicuahang">ƒê·ªãa ch·ªâ:</div>
    <div id="dienthoaicuahang">SƒêT:</div>
  </div>

  <h3>H√ìA ƒê∆†N B√ÅN H√ÄNG</h3>
  <div class="center" id="ngayin">Ng√†y gi·ªù in: </div>

  <div class="barcode-box">
    <img id="barcode" alt="M√£ v·∫°ch ƒë∆°n h√†ng"/>
  </div>

  <!-- M√£ Hƒê ·∫©n h·∫≥n -->
  <div id="idhd" style="display:none;"></div>

  <button onclick="window.print()">üñ® In h√≥a ƒë∆°n</button>

  <p>Kh√°ch h√†ng: <span id="tenkh"></span></p>
  <p>ƒê·ªãa ch·ªâ: <span id="diachikh"></span></p>
  <p>S·ªë ti·ªÅn thanh to√°n: <span id="thanhtoan"></span> VND</p>

  <table id="itemTable">
    <thead>
      <tr>
        <th>STT</th>
        <th>T√™n h√†ng</th>
        <th>SL</th>
        <th>ƒê∆°n gi√°</th>
        <th>Th√†nh ti·ªÅn</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="center" id="qrcode"></div>
  <div class="footer">Xin c·∫£m ∆°n qu√Ω kh√°ch! H·∫πn g·∫∑p l·∫°i!</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);

    document.getElementById("tencuahang").textContent = urlParams.get("tencuahang") || "C·ª≠a h√†ng ch∆∞a ƒë·∫∑t t√™n";
    document.getElementById("diachicuahang").textContent = "ƒê·ªãa ch·ªâ: " + (urlParams.get("diachicuahang") || "");
    document.getElementById("dienthoaicuahang").textContent = "SƒêT: " + (urlParams.get("dienthoaicuahang") || "");

    document.getElementById("tenkh").textContent = urlParams.get("ten") || "";
    document.getElementById("diachikh").textContent = urlParams.get("diachi") || "";
    document.getElementById("thanhtoan").textContent = urlParams.get("thanhtoan") || "0";

    const id = urlParams.get("id") || "";
    document.getElementById("idhd").textContent = "M√£ Hƒê: " + id;

    if (id) {
      document.getElementById("barcode").src =
        "https://barcode.tec-it.com/barcode.ashx?data=" + id + "&code=Code128&translate-esc=on";
    }

    // Ng√†y gi·ªù in h√≥a ƒë∆°n
    const now = new Date();
    const formattedDate = now.toLocaleString("vi-VN");
    document.getElementById("ngayin").textContent = "Ng√†y gi·ªù in: " + formattedDate;

    // Danh s√°ch s·∫£n ph·∫©m
    const data = urlParams.get("data") || "";
    const rows = data.split("_n_");
    const tbody = document.querySelector("#itemTable tbody");
    let totalQty = 0, totalMoney = 0;

    rows.forEach((row, index) => {
      if (row.trim() === "") return;
      const parts = row.split("|");
      if (parts.length >= 6) {
        const sl = parseFloat(parts[3]) || 0;
        const gia = parseFloat(parts[4]) || 0;
        const thanhtien = parseFloat(parts[5]) || 0;
        totalQty += sl;
        totalMoney += thanhtien;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${parts[1]}</td>
          <td>${sl}</td>
          <td>${gia}</td>
          <td>${thanhtien}</td>
        `;
        tbody.appendChild(tr);
      }
    });

    const trTotal = document.createElement("tr");
    trTotal.className = "total-row";
    trTotal.innerHTML = `
      <td colspan="2">T·ªîNG C·ªòNG</td>
      <td>${totalQty}</td>
      <td></td>
      <td>${totalMoney}</td>
    `;
    tbody.appendChild(trTotal);

    // QR thanh to√°n
    const bank = urlParams.get("bank") || "";
    const stk = urlParams.get("stk") || "";
    const chutk = urlParams.get("chutk") || "";
    const payCode = `Bank: ${bank}\nSTK: ${stk}\nCh·ªß TK: ${chutk}\nS·ªë ti·ªÅn: ${urlParams.get("thanhtoan") || 0}`;
    new QRCode(document.getElementById("qrcode"), { text: payCode, width: 120, height: 120 });
  </script>
</body>
</html>
