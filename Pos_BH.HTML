<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>H√≥a ƒë∆°n b√°n h√†ng</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, h3 { text-align: center; margin: 5px 0; }
    .barcode-box { text-align: center; margin: 10px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #000; padding: 5px; text-align: center; }
    tfoot td { font-weight: bold; }
    .footer { text-align: center; margin-top: 20px; font-style: italic; }
    .print-btn { display: block; text-align: center; margin: 15px 0; }
  </style>
</head>
<body>

  <h2 id="tencuahang">C·ª≠a h√†ng</h2>
  <div id="thongtin">
    <div id="diachicuahang">ƒê·ªãa ch·ªâ: </div>
    <div id="dienthoaicuahang">SƒêT: </div>
  </div>

  <h3>H√ìA ƒê∆†N B√ÅN H√ÄNG</h3>

  <!-- M√£ v·∫°ch ƒë∆°n h√†ng -->
  <div class="barcode-box">
    <img id="barcode" alt="M√£ v·∫°ch ƒë∆°n h√†ng">
  </div>

  <!-- ·∫®n d√≤ng M√£ Hƒê (kh√¥ng hi·ªÉn th·ªã) -->

  <div class="print-btn">
    <button onclick="window.print()">üñ® In h√≥a ƒë∆°n</button>
  </div>

  <p><strong>Kh√°ch h√†ng:</strong> <span id="tenkhach"></span></p>
  <p><strong>ƒê·ªãa ch·ªâ:</strong> <span id="diachikhach"></span></p>
  <p><strong>S·ªë ti·ªÅn thanh to√°n:</strong> <span id="thanhtoan"></span> VND</p>

  <table>
    <thead>
      <tr>
        <th>STT</th>
        <th>T√™n h√†ng</th>
        <th>SL</th>
        <th>ƒê∆°n gi√°</th>
        <th>Th√†nh ti·ªÅn</th>
      </tr>
    </thead>
    <tbody id="chitiet"></tbody>
    <tfoot>
      <tr>
        <td colspan="2">T·ªîNG C·ªòNG</td>
        <td id="tongsl"></td>
        <td></td>
        <td id="tongtien"></td>
      </tr>
    </tfoot>
  </table>

  <!-- QR Code thanh to√°n -->
  <div class="barcode-box">
    <img id="qrcode" alt="QR Thanh to√°n">
  </div>

  <div class="footer">
    Xin c·∫£m ∆°n qu√Ω kh√°ch v√† h·∫πn g·∫∑p l·∫°i!
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);

    document.getElementById("tencuahang").textContent = params.get("tencuahang") || "Ch∆∞a ƒë·∫∑t t√™n";
    document.getElementById("diachicuahang").textContent = "ƒê·ªãa ch·ªâ: " + (params.get("diachicuahang") || "");
    document.getElementById("dienthoaicuahang").textContent = "SƒêT: " + (params.get("dienthoaicuahang") || "");

    document.getElementById("tenkhach").textContent = params.get("ten") || "";
    document.getElementById("diachikhach").textContent = params.get("diachi") || "";
    document.getElementById("thanhtoan").textContent = params.get("thanhtoan") || "0";

    // Barcode m√£ ƒë∆°n h√†ng
    const id = params.get("id") || "";
    document.getElementById("barcode").src =
      "https://barcode.tec-it.com/barcode.ashx?code=Code128&data=" + id;

    // QR thanh to√°n
    const bank = params.get("bank") || "";
    const stk = params.get("stk") || "";
    const chutk = params.get("chutk") || "";
    const sotien = params.get("thanhtoan") || "";
    document.getElementById("qrcode").src =
      `https://img.vietqr.io/image/${bank}-${stk}-compact2.jpg?amount=${sotien}&addInfo=${id}&accountName=${encodeURIComponent(chutk)}`;

    // Chi ti·∫øt s·∫£n ph·∫©m
    const data = params.get("data") || "";
    let rows = data.split("_n_");
    let tbody = document.getElementById("chitiet");
    let tongsl = 0, tongtien = 0;

    rows.forEach((row, i) => {
      let parts = row.split("|");
      if (parts.length >= 6) {
        let tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${parts[1]}</td>
          <td>${parts[3]}</td>
          <td>${parts[4]}</td>
          <td>${parts[5]}</td>
        `;
        tbody.appendChild(tr);

        tongsl += parseInt(parts[3]) || 0;
        tongtien += parseInt(parts[5]) || 0;
      }
    });

    document.getElementById("tongsl").textContent = tongsl;
    document.getElementById("tongtien").textContent = tongtien;
  </script>
</body>
</html>
