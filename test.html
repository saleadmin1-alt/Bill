<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Hóa đơn bán hàng</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { text-align: center; margin: 5px 0; }
    .center { text-align: center; }
    .store-info { text-align: center; margin-bottom: 10px; }
    .barcode-box { text-align: center; margin-bottom: 15px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    table, th, td { border: 1px solid black; }
    th, td { padding: 5px; text-align: center; }
    .total { font-weight: bold; }
  </style>
</head>
<body>

  <div class="store-info">
    <div id="storeName">Cửa hàng chưa đặt tên</div>
    <div id="storeAddress">Địa chỉ:</div>
    <div id="storePhone">SĐT:</div>
  </div>

  <h2>HÓA ĐƠN BÁN HÀNG</h2>
  <div class="center">Mã HĐ: <span id="invoiceId"></span></div>

  <table id="invoiceTable">
    <thead>
      <tr>
        <th>STT</th>
        <th>Tên hàng</th>
        <th>SL</th>
        <th>Đơn giá</th>
        <th>Thành tiền</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr class="total">
        <td colspan="4">TỔNG CỘNG</td>
        <td id="totalAmount">0</td>
      </tr>
    </tfoot>
  </table>

  <script>
    // Lấy param từ URL
    const params = new URLSearchParams(window.location.search);

    // Lấy thông tin cửa hàng
    document.getElementById("storeName").textContent = params.get("tencuahang") || "Cửa hàng chưa đặt tên";
    document.getElementById("storeAddress").textContent = "Địa chỉ: " + (params.get("diachicuahang") || "");
    document.getElementById("storePhone").textContent = "SĐT: " + (params.get("dienthoaicuahang") || "");
    document.getElementById("invoiceId").textContent = params.get("id") || "";

    // Lấy dữ liệu sản phẩm
    const data = params.get("data");
    if (data) {
      const rows = data.split("_n_");
      const tbody = document.querySelector("#invoiceTable tbody");
      let total = 0;

      rows.forEach((row, index) => {
        const parts = row.split("|");
        if (parts.length >= 6) {
          const name = parts[1];
          const qty = parts[3];
          const price = parts[4];
          const amount = parts[5];

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${name}</td>
            <td>${qty}</td>
            <td>${price}</td>
            <td>${amount}</td>
          `;
          tbody.appendChild(tr);

          total += parseFloat(amount) || 0;
        }
      });

      document.getElementById("totalAmount").textContent = total.toLocaleString("vi-VN") + " VND";
    }
  </script>
</body>
</html>
