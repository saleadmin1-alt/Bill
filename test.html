<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
function exportExcelFull() {
  const wb = XLSX.utils.book_new();
  const ws_data = [
    ["CÔNG TY TNHH AURY VIỆT NAM"],
    ["Head Office: Lầu 9, Tòa nhà Viễn Đông, 14 Phan Tôn, Phường Tân Định, TP Hồ Chí Minh"],
    ["Showroom: 211 Đỗ Pháp Thuận, Phường Bình Trưng, Thành Phố Thủ Đức"],
    ["Tax code: 0313074659"],
    ["Phone: 0985 190 667 | Email: info@auryvietnam.com | Website: auryvietnam.com"],
    [],
    ["XÁC NHẬN ĐƠN HÀNG"],
    ["Mã đơn hàng:", document.getElementById("invoiceId").textContent],
    ["Ngày tạo đơn:", new Date().toLocaleDateString("vi-VN")],
    [],
    ["I. THÔNG TIN MUA HÀNG"],
    ["Khách hàng:", document.querySelector("#info b") ? document.querySelector("#info").innerText : ""],
    ["Địa chỉ:", ""],
    ["Điện thoại:", ""],
    [],
    ["II. TÀI KHOẢN THANH TOÁN"],
    ["Ngân hàng:", "Ngân hàng TMCP Việt Nam Thịnh Vượng"],
    ["Swift code:", "VPBKVNVX"],
    ["Số tài khoản:", "114210595"],
    ["Người thụ hưởng:", "CÔNG TY TNHH AURY VIỆT NAM"],
    [],
    ["III. CHI TIẾT SẢN PHẨM"],
    ["STT","SKU","SẢN PHẨM","SỐ LƯỢNG","ĐƠN VỊ","ĐƠN GIÁ","THÀNH TIỀN","CHIẾT KHẤU","THÀNH TIỀN SAU CK"]
  ];

  // Lấy dữ liệu sản phẩm từ bảng web
  const rows = document.querySelectorAll("#billTable tbody tr");
  rows.forEach(r => {
    const cols = Array.from(r.querySelectorAll("td")).map(td => td.innerText);
    // Bổ sung thêm cột chiết khấu & sau chiết khấu (ví dụ: =thành tiền)
    ws_data.push([...cols, 0, cols[6]]);
  });

  ws_data.push([]);
  ws_data.push(["Tổng tiền hàng (chưa VAT):", document.getElementById("tongTienCell").innerText]);
  ws_data.push(["Tiền thuế GTGT %:", ""]);
  ws_data.push(["Tổng thanh toán:", document.getElementById("tongTienCell").innerText]);
  ws_data.push(["Đã tạm ứng:", ""]);
  ws_data.push(["Số tiền còn lại:", document.getElementById("tongTienCell").innerText]);

  ws_data.push([]);
  ws_data.push(["Người lập phiếu","Thủ kho","Người nhận hàng"]);
  ws_data.push(["(Ký, họ tên)","(Ký, họ tên)","(Ký, họ tên)"]);

  const ws = XLSX.utils.aoa_to_sheet(ws_data);

  // Auto width
  const colWidths = ws_data[0].map((_, i) => ({wch: 20}));
  ws['!cols'] = colWidths;

  XLSX.utils.book_append_sheet(wb, ws, "Xác nhận ĐH");
  XLSX.writeFile(wb, `XacNhanDonHang_${Date.now()}.xlsx`);
}
</script>
