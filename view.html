<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>X√°c nh·∫≠n ƒë∆°n h√†ng</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/xlsx-populate/browser/xlsx-populate.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f3f4f6;
      padding: 1.5rem;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background-color: #ffffff;
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      font-size: 0.75rem; /* text-xs */
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #f9fafb;
      font-weight: 600;
    }
    .font-semibold-custom {
      font-weight: 600;
    }
    h1 { font-size: 1rem; }
    h2 { font-size: 1.25rem; }
    h3 { font-size: 1rem; }
    p, span, div { font-size: 0.75rem; }

    /* Khi in ·∫©n n√∫t */
    @media print {
      .print-button {
        display: none !important;
      }
      .container {
        box-shadow: none;
        border-radius: 0;
        padding: 0;
        max-width: 100%;
      }
      body {
        background-color: #fff;
        margin: 0;
        padding: 0;
      }
      @page {
        size: A4;
        margin: 1cm;
      }
      .table-header-center th {
        white-space: nowrap;
      }
      .breakable-header {
        white-space: normal;
      }
    }
    .table-header-center th {
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- N√∫t h√†nh ƒë·ªông -->
    <div class="flex justify-end mb-4">
      <button onclick="printPDF()" 
        class="print-button px-4 py-2 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 ease-in-out mr-2">
        üìÑ Xu·∫•t PDF
      </button>
      <button onclick="exportFromTemplate()" 
        class="print-button px-4 py-2 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition duration-300 ease-in-out">
        üì• Xu·∫•t Excel
      </button>
    </div>

    <!-- N·ªôi dung c√≤n l·∫°i c·ªßa b·∫°n (Logo, th√¥ng tin ƒë∆°n h√†ng, b·∫£ng s·∫£n ph·∫©m, ch·ªØ k√Ω...) -->
    <div class="text-center my-6">
      <h2 class="text-2xl font-bold text-gray-900 uppercase">X√ÅC NH·∫¨N ƒê∆†N H√ÄNG</h2>
      <p id="order-info" class="text-sm text-gray-500 mt-1"></p>
    </div>
    <!-- ... ph·∫ßn n·ªôi dung kh√°c gi·ªØ nguy√™n ... -->

  </div>

  <script>
    /* ====== H√†m in PDF ·∫©n n√∫t ====== */
    function printPDF() {
      const buttons = document.querySelectorAll('.print-button');
      buttons.forEach(btn => btn.style.display = 'none');
      window.print();
      setTimeout(() => {
        buttons.forEach(btn => btn.style.display = '');
      }, 500);
    }

    /* ====== H√†m format ====== */
    function formatCurrency(number, decimalPlaces = 0) {
      const n = parseFloat(number) || 0;
      return new Intl.NumberFormat('vi-VN', {
        minimumFractionDigits: decimalPlaces,
        maximumFractionDigits: decimalPlaces,
      }).format(n);
    }

    function getDiscountDisplay(rate, amount, total) {
      if (!rate && !amount) return "";
      let displayRate = rate;
      if (rate && !rate.toString().includes("%")) {
        const num = parseFloat(rate);
        if (num <= 1) displayRate = (num * 100).toFixed(2) + "%";
        else displayRate = num.toFixed(2) + "%";
      }
      if (!displayRate && amount && total) {
        const calc = (amount / total) * 100;
        displayRate = calc.toFixed(2) + "%";
      }
      return displayRate + " | " + formatCurrency(amount);
    }

    /* ====== Parse URL (gi·ªØ nguy√™n code c≈© c·ªßa b·∫°n) ====== */
    const params = new URLSearchParams(window.location.search);
    // ... (ƒëo·∫°n code l·∫•y d·ªØ li·ªáu t·ª´ params v√† hi·ªÉn th·ªã n·ªôi dung nh∆∞ c≈©) ...

    /* ====== Xu·∫•t Excel theo template ====== */
    async function exportFromTemplate() {
      const url = "https://raw.githubusercontent.com/saleadmin1-alt/bill-template/main/template.xlsx";
      const response = await fetch(url);
      const buffer = await response.arrayBuffer();
      const workbook = await XlsxPopulate.fromDataAsync(buffer);
      const sheet = workbook.sheet(0);
      // ... (ghi d·ªØ li·ªáu v√†o Excel nh∆∞ code b·∫°n c√≥ s·∫µn) ...
      workbook.outputAsync().then(function(blob) {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "DonHang_" + params.get("madonhang") + ".xlsx";
        a.click();
        window.URL.revokeObjectURL(url);
      });
    }
  </script>
</body>
</html>
