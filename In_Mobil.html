<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>H√≥a ƒë∆°n b√°n h√†ng</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 5px;
  font-size: 12px;
}

/* Ti√™u ƒë·ªÅ */
h2 { text-align: center; font-size: 16px; margin-bottom: 5px; }
#info p { margin: 2px 0; font-size: 12px; }

/* B·∫£ng s·∫£n ph·∫©m */
table { width: 100%; border-collapse: collapse; table-layout: fixed; }
td { border: none; padding: 2px 4px; word-wrap: break-word; font-size: 12px; }
.total-row td { font-weight: bold; text-align: right; }

/* STT + T√™n h√†ng */
.item-name { font-weight: bold; display: block; margin-bottom: 2px; }

/* SL ‚Äì ƒê∆°n gi√° ‚Äì Th√†nh ti·ªÅn */
.item-detail { display: flex; justify-content: space-between; font-size: 11px; }

/* N√∫t in v√† ch·ªçn kh·ªï gi·∫•y */
#printBtn { position: fixed; bottom: 10px; right: 10px; background: #007bff; color: #fff; border: none; padding: 8px 14px; border-radius: 6px; font-size: 14px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
#printBtn:active { background: #0056b3; }
label { font-size: 12px; }
#paperWidth { font-size: 12px; margin-left: 5px; }

/* In ·∫•n */
@media print {
  body { width: 207px; margin:0; font-size:10px; } /* 55mm ‚âà 207px @96dpi */
  #printBtn, #paperWidth, label { display: none; }
  table { font-size: 10px; }
}
</style>
</head>
<body>

<h2>H√ìA ƒê∆†N B√ÅN H√ÄNG</h2>

<label for="paperWidth">Ch·ªçn kh·ªï gi·∫•y:</label>
<select id="paperWidth">
  <option value="55mm" selected>55mm</option>
  <option value="58mm">58mm</option>
  <option value="60mm">60mm</option>
  <option value="70mm">70mm</option>
</select>

<div id="info"></div>

<table id="billTable">
  <tbody></tbody>
  <tfoot>
    <tr class="total-row">
      <td>T·ªîNG C·ªòNG</td>
      <td id="tongSlCell"></td>
      <td id="tongTienCell"></td>
    </tr>
  </tfoot>
</table>

<button id="printBtn" onclick="window.print()">üñ® In</button>

<script>
// L·∫•y th√¥ng tin t·ª´ URL
const params = new URLSearchParams(window.location.search);
const id = params.get("id") || "";
const ten = decodeURIComponent(params.get("ten") || "");
const diachi = decodeURIComponent(params.get("diachi") || "");
document.getElementById("info").innerHTML = `
<p><b>M√£ ƒë∆°n h√†ng:</b> ${id}</p>
<p><b>Kh√°ch h√†ng:</b> ${ten}</p>
<p><b>ƒê·ªãa ch·ªâ:</b> ${diachi}</p>
`;

// D·ªØ li·ªáu s·∫£n ph·∫©m
const data = decodeURIComponent(params.get("data") || "");
const rows = data.split("_n_");
const tbody = document.querySelector("#billTable tbody");
let tongSL=0, tongTien=0;

rows.forEach((r,index)=>{
  if(r.trim()!==""){
    const cols = r.split("|");
    const tr = document.createElement("tr");
    const td = document.createElement("td");

    td.innerHTML = `<span class="item-name">${index+1}. ${cols[1]||""}</span>
                    <div class="item-detail">
                      <span>SL: ${cols[2]||""}</span>
                      <span>ƒêG: ${cols[3]||""}</span>
                      <span>TT: ${cols[4]||""}</span>
                    </div>`;
    tr.appendChild(td);

    // T√≠nh t·ªïng
    const sl = parseFloat((cols[2]||"0").replace(/[^0-9.-]/g,""))||0;
    const tien = parseFloat((cols[4]||"0").replace(/[^0-9.-]/g,""))||0;
    tongSL += sl;
    tongTien += tien;

    tbody.appendChild(tr);
  }
});

document.getElementById("tongSlCell").textContent = tongSL.toLocaleString("vi-VN");
document.getElementById("tongTienCell").textContent = tongTien.toLocaleString("vi-VN")+" VND";
document.getElementById("info").innerHTML += `<p><b>T·ªïng SL:</b> ${tongSL}</p>`;

// Ch·ªçn kh·ªï gi·∫•y
const paperSelect = document.getElementById("paperWidth");
paperSelect.addEventListener("change", function(){
  const width = this.value;
  let styleEl = document.getElementById("printWidthStyle");
  if(!styleEl){
    styleEl = document.createElement("style");
    styleEl.id = "printWidthStyle";
    document.head.appendChild(styleEl);
  }
  let fontSize = "10px";
  let pxWidth = 207; // m·∫∑c ƒë·ªãnh 55mm
  if(width==="55mm"){ fontSize="10px"; pxWidth=207; }
  else if(width==="58mm"){ fontSize="11px"; pxWidth=217; }
  else if(width==="60mm"){ fontSize="12px"; pxWidth=226; }
  else if(width==="70mm"){ fontSize="14px"; pxWidth=264; }

  styleEl.innerHTML = `
    @media print{
      body{width:${pxWidth}px; margin:0; font-size:${fontSize};}
      table{font-size:${fontSize};}
    }`;
});
</script>

</body>
</html>
