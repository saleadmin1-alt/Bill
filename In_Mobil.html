<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>H√≥a ƒë∆°n b√°n h√†ng</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; margin: 10px; font-size: 14px; }
h2 { text-align: center; font-size: 18px; margin-bottom: 10px; }
#info p { margin: 2px 0; font-size: 14px; }

/* B·∫£ng g·ªçn, b·ªè vi·ªÅn */
table { width: 100%; margin-top: 10px; font-size: 13px; border-collapse: collapse; table-layout: fixed; }
th, td { border: none; padding: 3px 5px; text-align: left; word-wrap: break-word; }
th { font-weight: bold; background: #f9f9f9; }
.total-row td { font-weight: bold; }

/* In */
@media print {
  body { width: 58mm; margin:0; font-size:12px; }
  #printBtn, #paperWidth, label { display: none; }
  table { font-size: 12px; }
}

/* N√∫t in v√† ch·ªçn kh·ªï gi·∫•y */
#printBtn { position: fixed; bottom:15px; right:15px; background:#007bff; color:#fff; border:none; padding:10px 16px; border-radius:8px; font-size:16px; cursor:pointer; box-shadow:0 3px 6px rgba(0,0,0,0.2); }
#printBtn:active { background:#0056b3; }
label { font-size:14px; }
#paperWidth { font-size:14px; margin-left:5px; }
</style>
</head>
<body>
<h2>H√ìA ƒê∆†N B√ÅN H√ÄNG</h2>

<label for="paperWidth">Ch·ªçn kh·ªï gi·∫•y:</label>
<select id="paperWidth">
  <option value="55mm">55mm</option>
  <option value="58mm" selected>58mm</option>
  <option value="60mm">60mm</option>
  <option value="70mm">70mm</option>
</select>

<div id="info"></div>
<table id="billTable">
  <tbody></tbody>
  <tfoot>
    <tr class="total-row">
      <td>T·ªîNG C·ªòNG</td>
      <td id="tongSlCell">0</td>
      <td id="tongTienCell">0</td>
    </tr>
  </tfoot>
</table>

<button id="printBtn" onclick="window.print()">üñ® In</button>

<script>
const params = new URLSearchParams(window.location.search);
const id = params.get("id") || "";
const ten = decodeURIComponent(params.get("ten") || "");
const diachi = decodeURIComponent(params.get("diachi") || "");

document.getElementById("info").innerHTML = `
<p><b>M√£ ƒë∆°n h√†ng:</b> ${id}</p>
<p><b>Kh√°ch h√†ng:</b> ${ten}</p>
<p><b>ƒê·ªãa ch·ªâ:</b> ${diachi}</p>
`;

const data = decodeURIComponent(params.get("data") || "");
const rows = data.split("_n_");

const tbody = document.querySelector("#billTable tbody");
let tongSL = 0;
let tongTien = 0;

rows.forEach((r,index)=>{
  if(r.trim()!==""){
    const cols = r.split("|");
    const tr = document.createElement("tr");

    const td = document.createElement("td");
    td.innerHTML = `<b>${index+1}. ${cols[1] || ""}</b><br>
                    SL: ${cols[2] || ""} | ƒê∆°n gi√°: ${cols[3] || ""} | Th√†nh ti·ªÅn: ${cols[4] || ""}`;
    tr.appendChild(td);

    // T√≠nh t·ªïng
    const sl = parseFloat((cols[2]||"0").replace(/[^0-9.-]/g,""))||0;
    const tien = parseFloat((cols[4]||"0").replace(/[^0-9.-]/g,""))||0;
    tongSL += sl;
    tongTien += tien;

    tbody.appendChild(tr);
  }
});

document.getElementById("tongSlCell").textContent = tongSL.toLocaleString("vi-VN");
document.getElementById("tongTienCell").textContent = tongTien.toLocaleString("vi-VN")+" VND";
document.getElementById("info").innerHTML += `<p><b>T·ªïng SL:</b> ${tongSL}</p>`;

// Ch·ªçn kh·ªï gi·∫•y
const paperSelect = document.getElementById("paperWidth");
paperSelect.addEventListener("change", function(){
  const width = this.value;
  let styleEl = document.getElementById("printWidthStyle");
  if(!styleEl){
    styleEl = document.createElement("style");
    styleEl.id = "printWidthStyle";
    document.head.appendChild(styleEl);
  }
  let fontSize = "12px";
  if(width==="55mm") fontSize="10px";
  else if(width==="58mm") fontSize="12px";
  else if(width==="60mm") fontSize="13px";
  else if(width==="70mm") fontSize="14px";

  styleEl.innerHTML = `
  @media print{
    body{width:${width}; margin:0; font-size:${fontSize};}
    table{font-size:${fontSize};}
  }`;
});
</script>
</body>
</html>
